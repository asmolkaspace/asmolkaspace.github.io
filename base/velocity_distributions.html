<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Velocity Distributions · ExESS Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">ExESS Documentation</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Research Code Collection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Base Functions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="constants.html">Constants</a></li><li><a class="tocitem" href="coordinate_systems.html">Coordinate Systems</a></li><li class="is-active"><a class="tocitem" href="velocity_distributions.html">Velocity Distributions</a><ul class="internal"><li><a class="tocitem" href="#Manual"><span>Manual</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Benchmark"><span>Benchmark</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="utils.html">Utility</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Numerical Grids</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../grids/structured.html">Structured Grids</a></li><li><a class="tocitem" href="../grids/fspiral.html">Fibonacci Spiral Grids</a></li><li><a class="tocitem" href="../grids/healpix.html">HEALPix Grids</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Surfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../surfaces/solar_angle.html">Solar Angles</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Exospheres</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../exospheres/orbital_mechanics.html">Orbital Mechanics</a></li><li><a class="tocitem" href="../exospheres/coriolis.html">Coriolis</a></li><li><a class="tocitem" href="../exospheres/trajectory.html">Trajectory</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Research Code Collection</a></li><li><a class="is-disabled">Base Functions</a></li><li class="is-active"><a href="velocity_distributions.html">Velocity Distributions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="velocity_distributions.html">Velocity Distributions</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Velocity-Distributions"><a class="docs-heading-anchor" href="#Velocity-Distributions">Velocity Distributions</a><a id="Velocity-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-Distributions" title="Permalink"></a></h1><p><a href="../index.html#ExESS"><code>ExESS</code></a> has build-in energy and velocity distributions that are used to draw random velocities for various processes.</p><p>For further information, please refer to <a href="https://www.researchgate.net/publication/361163635_Lunar_Exosphere_Simulation_Modeling_and_Simulation_of_our_Moon&#39;s_Surface-Bounded_Exosphere">Smolka (2022)</a>.</p><hr/><p>A total of two different velocity distributions are implemented, the <a href="https://en.wikipedia.org/wiki/Maxwell%E2%80%93Boltzmann_distribution">Maxwell-Boltzmann</a> and the <a href="https://doi.org/10.1007/s11038-022-09547-5">Maxwell-Boltzmann Flux</a> distribution. Both are used to randomly draw a velocity vector based on the thermal energy available to a particle of a certain mass. In one-dimensional form, the former can be expressed as</p><p class="math-container">\[f(v) = \sqrt{\frac{m}{2 \pi k_B T}} \exp \left( - \frac{m |v|^2}{2 k_B T} \right)\]</p><p>which is directly related to a Gaussian distribution with mean zero and variance <span>$\frac{k_B T}{m}$</span> <a href="https://doi.org/10.1016/S0273-1177(02)00493-3">Crider and Vondrak (2002)</a>. The extension to three dimensions is the product of all three normal distributions <span>$f(v_x, v_y, v_z) = f(v_x) f(v_y) f(v_z)$</span>, leading to velocity components that can be directly drawn from a scaled up normal distribution </p><p class="math-container">\[v_i = \sqrt{\frac{k_BT}{m}} \cdot \mathcal{N}(0, 1).\]</p><p>The latter distribution assumes that the velocities are drawn from the appropriate flux expression</p><p class="math-container">\[F = \rho_0 \left( \frac{m}{2 \pi k_B T} \right) ^{3/2} \int_0^\infty \int_{\vartheta=0}^{\pi / 2} \int_{\phi=0}^{2 \pi} v^2 \exp \left( - \frac{m v^2}{2 k_B T} \right) \left( v \cos \vartheta \right) \sin \vartheta \; d\vartheta \; d\varphi \; dv,\]</p><p>which, integrated twice over both angular coordinates, leads to the simplified expression</p><p class="math-container">\[F = \rho_0 \left( \frac{m}{2 \pi k_B T} \right) ^{3/2} \pi \int_0^\infty v^3 \exp \left( - \frac{m v^2}{2 k_B T} \right) dv.\]</p><p>The velocity can now be drawn numerically, based on the mapping of three pseudo-random numbers <span>$r_1, r_2, r_3 \in [0,1)$</span>.</p><p class="math-container">\[r_1 = \frac{\int_0^v v^3 \exp \left( - \frac{m v^2}{2 k_B T} \right) \, dv}{\int_0^\infty v^3 \exp \left( - \frac{m v^2}{2 k_B T} \right) \, dv},\]</p><p>for the magnitude, <span>$r_2 = \cos^2 \theta$</span> for the attitude angle, and <span>$r_3 = \frac{\phi}{2\pi}$</span> for the azimuth <a href="https://doi.org/10.1016/0032-0633(70)90124-8">Brinkmann (1970)</a>.</p><h2 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h2><p><a href="velocity_distributions.html#Main.ExESS.maxwellvdist"><code>maxwellvdist</code></a> and <a href="velocity_distributions.html#Main.ExESS.mbfluxvdist"><code>mbfluxvdist</code></a> return the distributions as functions that can be used to draw random velocity vectors. This comes with the advantage that the distribution has to be called only once, while the drawing of the velocities can occur multiple times, based on the same distribution. </p><pre><code class="language-julia hljs"># load and use ExESS package
include(joinpath(PathToPackage, &quot;src&quot;, &quot;ExESS.jl&quot;))
using .ExESS

# create velocity distributions, using Helium (4) particles
f_max = maxwellvdist(4)
f_mbf = mbfluxvdist(4)

# draw from velocity distributions, using a thermal energy according to a temperature of 250K
v_max = f_max(250)
v_mbf = f_mbf(250)</code></pre><p>Note that both <code>f_max</code> and <code>f_mbf</code> are <strong>specialized</strong> for a certain <a href="https://en.wikipedia.org/wiki/Dalton_(unit)">atomic mass unit</a>, in this case having the value <code>4</code>, which stands for the weight of the particle for which the velocity is drawn. They are <strong>not specialized</strong> for the temperature, which is supplied only when the actual velocities are drawn from the functions.</p><p>The function <a href="velocity_distributions.html#Main.ExESS.mbfluxvdist"><code>mbfluxvdist</code></a> comes with two additional keyword arguments, namely <code>N</code> and <code>atol</code>, which control the numerical creation of the distribution. The former stands for the number of sample points made in the probability space <span>$\left[0,1\right)$</span>, in between which the distribution is linearly interpolating, while the latter stands for the absolute tolerance used during the mapping at each of the <code>N</code> sample points to the corresponding velocity magnitude. Adjusting the two factors has the following influence on the distribution:</p><table><tr><th style="text-align: left">Increasing <code>N</code></th><th style="text-align: left">Decreasing <code>atol</code></th></tr><tr><td style="text-align: left">higher computational effort</td><td style="text-align: left">higher computational effort</td></tr><tr><td style="text-align: left">more accurate linear interpolation</td><td style="text-align: left">more accurate calculation at sample points</td></tr><tr><td style="text-align: left">higher maximum velocity</td><td style="text-align: left"></td></tr></table><p>The last influence listed under <strong>Increasing <code>N</code></strong> is because theoretically, the velocity magnitude corresponding to the sample point of 1 is infinity. Thus, the samples are created as</p><pre><code class="language-julia hljs">samples = range(0, 1-1/N, N)</code></pre><p>which means that the upper limit of the vector is approaching 1 with an increasing number of sample points.</p><p>If the user needs a different velocity distribution, a custom function can be built, which returns the new distribution as a function that randomly draws from it. A template is given below:</p><pre><code class="language-julia hljs">function my_custom_velocity_distribution(amu::Real; key=value)::Function
    # computations for equal `amu` values
    # ...

    function f_vdist(T::Real; key=value)::Vector{Float32}
        # computations for equal `T` values
        # ...
    end

    # returns distribution as a function that draws random velocity vectors
    return f_vdist
end</code></pre><p>To verify that the custom distribution is correctly set up, it can be tested using <a href="velocity_distributions.html#Main.ExESS.isvdist"><code>isvdist</code></a>, which returns <code>true</code> for a correct distribution and <code>false</code> for an incorrect one.</p><pre><code class="language-julia hljs"># correct velocity distributions
isvdist(f_max)  # true 
isvdist(f_mbf)  # true

# incorrect velocity distributions
isvdist(x -&gt; [1,2,3])   # false
isvdist(x -&gt; x)         # false
# ...</code></pre><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><h3 id="Normalized-PDF-and-CDF"><a class="docs-heading-anchor" href="#Normalized-PDF-and-CDF">Normalized PDF &amp; CDF</a><a id="Normalized-PDF-and-CDF-1"></a><a class="docs-heading-anchor-permalink" href="#Normalized-PDF-and-CDF" title="Permalink"></a></h3><p>The following shows the PDF and CDF of the two implemented distributions with the corresponding Julia script to create the data shown in the two figures.</p><table><tr><th style="text-align: left"><img src="imgs/norm_pdf.svg" alt/></th></tr><tr><td style="text-align: left"><strong>Figure 1: Normalized PDF</strong> Shows the probability densities for both a Maxwellian and a Maxwell-Boltzmann flux velocity distribution. The latter one peaks slightly later at higher velocities.</td></tr></table><table><tr><th style="text-align: left"><img src="imgs/norm_cdf.svg" alt/></th></tr><tr><td style="text-align: left"><strong>Figure 2: Normalized CDF</strong> Shows the cumulative probability densities for both a Maxwellian and a Maxwell-Boltzmann flux velocity distribution.</td></tr></table><pre><code class="language-julia hljs"># variables
N = 10_000_000  # number of samples
B = 100         # number of bins
u = 1           # atomic mass unit (placeholder)
T = 100         # temperature (placeholder)

# create distributions
f_max = ExESS.maxwellvdist(u)
f_mbf = ExESS.mbfluxvdist(u)

# sample distributions
using LinearAlgebra
vmax = [norm(f_max(T)) for _ in 1:N]
vmbf = [norm(f_mbf(T)) for _ in 1:N]

# create bins
bins = range(0, max(vcat(vmax, vmbf)...)*1.001, B+1)

# bin data
vmax_binned, vmbf_binned = zeros(B), zeros(B)
for i in 1:N
    # maxwellian
    for j in 1:B
        vmax[i] &lt; bins[j+1] ? (vmax_binned[j] += 1) : continue
        break;
    end
    # maxwell-boltzmann flux
    for j in 1:B
        vmbf[i] &lt; bins[j+1] ? (vmbf_binned[j] += 1) : continue
        break;
    end
end

# normalize probabilities
vmax_binned = vmax_binned ./ N ./ (bins[2] - bins[1]) .* 100
vmbf_binned = vmbf_binned ./ N ./ (bins[2] - bins[1]) .* 100

# calculate thermal velocity for normalization
vT = sqrt(BOLTZMANN_CONSTANT * T / (u / AVOGADRO_CONSTANT * 1e-3))

# save data
using DelimitedFiles
HEADER = [&quot;bins&quot; &quot;max&quot; &quot;mbf&quot;]
PDF = vcat(HEADER, hcat(bins[1:end-1] ./ vT, vmax_binned, vmbf_binned))
CDF = vcat(HEADER, hcat(bins[1:end-1] ./ vT, accumulate(+, vmax_binned .* (bins[2]-bins[1])), accumulate(+, vmbf_binned .* (bins[2]-bins[1]))))
writedlm(joinpath(@__DIR__, &quot;norm_pdf.csv&quot;), PDF, &#39;\t&#39;)
writedlm(joinpath(@__DIR__, &quot;norm_cdf.csv&quot;), CDF, &#39;\t&#39;)</code></pre><p>Assuming that the <a href="../index.html#ExESS"><code>ExESS</code></a> package is already included and loaded, the above script produces the data for both the PDF and CDF and stores them in <code>.csv</code> file, ready for plotting. Firstly, the necessary variables are created, where both the atomic mass unit <code>u</code> and the temperature <code>T</code> are only placeholders. Both variables are required for the calculations, though they are ultimately used to calculate the thermal velocity <code>vT</code> which normalizes the data, making the choice for <code>u</code> and <code>T</code> irrelevant for the presented visualization.</p><p>After the creation of the distribution, a total number of <code>N</code> samples are drawn from each one and the magnitude is calculated using <code>LinearAlgebra</code>&#39;s <code>norm()</code> function. Afterward, the samples are binned into <code>B</code> bins of equal size, and the resulting counts are normalized based on the total number of samples <code>N</code>, the bin size <code>bins[2]-bins[1]</code>, and the conversion to percent <code>100</code>. Using <a href="../index.html#ExESS"><code>ExESS</code></a> constants <a href="constants.html#Main.ExESS.BOLTZMANN_CONSTANT"><code>BOLTZMANN_CONSTANT</code></a> and <a href="constants.html#Main.ExESS.AVOGADRO_CONSTANT"><code>AVOGADRO_CONSTANT</code></a> the thermal velocity is calculated to also normalize the bins. The last step loads <code>DelimitedFiles</code> to write the <code>.csv</code> files based on the normalized probabilities.</p><h2 id="Benchmark"><a class="docs-heading-anchor" href="#Benchmark">Benchmark</a><a id="Benchmark-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark" title="Permalink"></a></h2><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Main.ExESS.isvdist" href="#Main.ExESS.isvdist"><code>Main.ExESS.isvdist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">[1] isvdist(f::Function)::Bool</code></pre><p>Checks if the function <code>f</code> can be used as a velocity distribution function.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="Main.ExESS.mbfluxvdist" href="#Main.ExESS.mbfluxvdist"><code>Main.ExESS.mbfluxvdist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">[1] mbfluxvdist(amu::Real; N=100_000, atol=1e-1)::Function</code></pre><p>Creates a function that draws a three-dimensional velocity vector from a Maxwell-Boltzmann flux velocity distribution, based on the thermal energy defined through the temperature <code>T</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="Main.ExESS.maxwellvdist" href="#Main.ExESS.maxwellvdist"><code>Main.ExESS.maxwellvdist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">[1] maxwellvdist(amu::Real)::Function</code></pre><p>Creates a function that draws a three-dimensional velocity vector from a Maxwellian velocity distribution, based on the thermal energy defined through the temperature <code>T</code>.</p></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="coordinate_systems.html">« Coordinate Systems</a><a class="docs-footer-nextpage" href="utils.html">Utility »</a><div class="flexbox-break"></div><p class="footer-message">Alexander Smolka | <a href="mailto:alexander.smolka@tum.de">alexander.smolka@tum.de</a> | 2022</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 21 February 2023 15:04">Tuesday 21 February 2023</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
